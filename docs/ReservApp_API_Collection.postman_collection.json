{
  "info": {
    "name": "ReservApp API - Complete Collection 2025",
    "description": "Colecci√≥n completa de la API de ReservApp con todos los endpoints actuales\n\nüåê **ReservApp** es una plataforma de gesti√≥n de reservas para hoteles, spas, restaurantes, tours y eventos con dashboard administrativo completo.\n\n## üÜï Nuevas Funcionalidades (Enero 2025)\nüì± **Dashboard M√≥vil**: Endpoint optimizado para apps m√≥viles con estad√≠sticas completas, favoritos y reservaciones en una sola llamada.\n‚ùå **Cancelaciones**: Sistema completo de cancelaci√≥n con reembolsos autom√°ticos basados en pol√≠tica de tiempo y emails de confirmaci√≥n.\n‚≠ê **Premium**: Upgrade a suscripci√≥n premium con integraci√≥n real de Stripe (sandbox), beneficios exclusivos y templates de email.\nüîß **Perfil Mejorado**: Endpoint de perfil ahora incluye estado `isPremium` para identificar usuarios premium.\nüí≥ **Pagos Reales**: Creaci√≥n de reservas ahora procesa pagos realmente en Stripe con Payment Intents, clientes autom√°ticos y registros completos.\nüîî **Notificaciones Completas**: Sistema de notificaciones en tiempo real con filtrado, paginaci√≥n, estados de lectura y creaci√≥n autom√°tica en reservas/pagos.\nüë®‚Äçüíº **Admin Notificaciones**: Panel administrativo para ver TODOS los emails enviados. SUPER_ADMIN ve todo, ADMIN solo ve emails de sus venues. Incluye estad√≠sticas completas, filtros avanzados y seguimiento de templates.\nüí∞ **Sistema Completo de Pagos y Facturas**: APIs completas para usuarios y admins con historial de pagos, generaci√≥n de facturas Stripe, descargas PDF, permisos diferenciados por rol y datos de ejemplo realistas para Juan P√©rez.\nüßæ **Gesti√≥n de Recibos**: Sistema completo de recibos y facturas con generaci√≥n de PDFs, tipos m√∫ltiples (PAYMENT, INVOICE, REFUND, CREDIT_NOTE) y descarga directa.\nüîß **Panel Admin Avanzado**: Gesti√≥n administrativa de pagos con filtros avanzados, reembolsos, estad√≠sticas y generaci√≥n de facturas Stripe.\n\n## üîë Autenticaci√≥n\nLa mayor√≠a de endpoints requieren autenticaci√≥n JWT. Incluye el token en el header:\n```\nAuthorization: Bearer tu-jwt-token\n```\n\n## üåê Servidores\n- **Producci√≥n**: https://reservapp-web.vercel.app/api (URL por defecto)\n- **Desarrollo**: http://localhost:3000/api\n\n## üë§ Cuentas de Prueba\n- **Super Admin**: admin@reservapp.com (password: password123)\n- **Admin Hotel**: admin.salazar@reservapp.com (password: password123)\n- **Admin Restaurante**: admin.restaurant@reservapp.com (password: password123)\n- **Usuario Final**: juan.perez@gmail.com (password: password123) ‚≠ê **Con datos completos para mobile**\n\n## üí≥ Stripe Testing (Sandbox)\nPara pruebas de suscripci√≥n premium:\n- **Visa**: `4242424242424242`\n- **Mastercard**: `5555555555554444`\n- **CVC**: `123`\n- **Fecha**: Cualquier fecha futura\n\n## üìß Email Templates\nSistema completo de emails autom√°ticos:\n- ‚úÖ Cancelaci√≥n de reservas con detalles de reembolso\n- ‚úÖ Bienvenida premium con beneficios y facturaci√≥n\n- ‚úÖ Confirmaci√≥n de reservas y pagos\n- ‚úÖ Recordatorios de check-in\n\n## üìö Documentaci√≥n\n- **API Docs**: https://reservapp-web.vercel.app/api/swagger\n- **Health Check**: https://reservapp-web.vercel.app/api/health\n\n## üÜï Nuevos Endpoints en esta Colecci√≥n\n- üí∞ **Payments & Receipts (Users)**: Gesti√≥n completa de pagos y recibos para usuarios\n- üîß **Admin Payments & Invoices**: Panel administrativo de pagos con facturas Stripe",
    "schema": "https://schema.getpostman.com/json/collection/v2.1.0/collection.json",
    "version": {
      "major": 3,
      "minor": 7,
      "patch": 0
    }
  },
  "variable": [
    {
      "key": "base_url",
      "value": "https://reservapp-web.vercel.app/api",
      "type": "string",
      "description": "Base URL para producci√≥n (Vercel)"
    },
    {
      "key": "prod_url",
      "value": "https://reservapp-web.vercel.app/api",
      "type": "string",
      "description": "Base URL para producci√≥n"
    },
    {
      "key": "jwt_token",
      "value": "",
      "type": "string",
      "description": "JWT token de autenticaci√≥n"
    },
    {
      "key": "user_id",
      "value": "",
      "type": "string",
      "description": "ID del usuario autenticado"
    },
    {
      "key": "venue_id",
      "value": "venue_123",
      "type": "string",
      "description": "ID de venue para testing"
    },
    {
      "key": "service_id",
      "value": "service_456",
      "type": "string",
      "description": "ID de servicio para testing"
    },
    {
      "key": "reservation_id",
      "value": "reservation_123",
      "type": "string",
      "description": "ID de reservaci√≥n para testing"
    },
    {
      "key": "payment_id",
      "value": "payment_456",
      "type": "string",
      "description": "ID de pago para testing"
    },
    {
      "key": "receipt_id",
      "value": "receipt_789",
      "type": "string",
      "description": "ID de recibo para testing"
    },
    {
      "key": "notification_id",
      "value": "notification_abc",
      "type": "string",
      "description": "ID de notificaci√≥n para testing"
    }
  ],
  "auth": {
    "type": "bearer",
    "bearer": [
      {
        "key": "token",
        "value": "{{jwt_token}}",
        "type": "string"
      }
    ]
  },
  "item": [
    {
      "name": "üîê Authentication",
      "item": [
        {
          "name": "Login Usuario",
          "event": [
            {
              "listen": "test",
              "script": {
                "type": "text/javascript",
                "exec": [
                  "// Guardar token autom√°ticamente para siguientes requests",
                  "if (pm.response.code === 200) {",
                  "    const response = pm.response.json();",
                  "    if (response.success && response.data && response.data.token) {",
                  "        pm.collectionVariables.set('jwt_token', response.data.token);",
                  "        pm.collectionVariables.set('user_id', response.data.user.id);",
                  "        console.log('‚úÖ Token guardado:', response.data.token.substring(0, 20) + '...');",
                  "        console.log('‚úÖ Usuario logueado:', response.data.user.email, '- Rol:', response.data.user.role);",
                  "    }",
                  "}",
                  "",
                  "pm.test('Login successful', function () {",
                  "    pm.expect(pm.response.code).to.equal(200);",
                  "    const response = pm.response.json();",
                  "    pm.expect(response.success).to.be.true;",
                  "    pm.expect(response.data.token).to.exist;",
                  "    pm.expect(response.data.user).to.exist;",
                  "});"
                ]
              }
            }
          ],
          "request": {
            "auth": {
              "type": "noauth"
            },
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"email\": \"admin@reservapp.com\",\n  \"password\": \"password123\"\n}"
            },
            "url": {
              "raw": "{{base_url}}/auth/login",
              "host": ["{{base_url}}"],
              "path": ["auth", "login"]
            },
            "description": "Autenticar usuario con email y contrase√±a. El JWT token se guarda autom√°ticamente para uso en otros endpoints."
          }
        },
        {
          "name": "Registro Usuario Final",
          "request": {
            "auth": {
              "type": "noauth"
            },
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"email\": \"nuevo.usuario@ejemplo.com\",\n  \"password\": \"password123\",\n  \"confirmPassword\": \"password123\",\n  \"firstName\": \"Usuario\",\n  \"lastName\": \"Nuevo\",\n  \"phone\": \"+52 33 1234 5678\",\n  \"role\": \"USER\"\n}"
            },
            "url": {
              "raw": "{{base_url}}/auth/register",
              "host": ["{{base_url}}"],
              "path": ["auth", "register"]
            },
            "description": "Registrar nuevo usuario final en la plataforma"
          }
        },
        {
          "name": "Obtener Perfil Usuario",
          "request": {
            "method": "GET",
            "header": [],
            "url": {
              "raw": "{{base_url}}/auth/profile",
              "host": ["{{base_url}}"],
              "path": ["auth", "profile"]
            },
            "description": "Obtener informaci√≥n del perfil del usuario autenticado con JWT token"
          }
        },
        {
          "name": "Logout",
          "request": {
            "method": "POST",
            "header": [],
            "body": {
              "mode": "raw",
              "raw": "",
              "options": {
                "raw": {
                  "language": "json"
                }
              }
            },
            "url": {
              "raw": "{{base_url}}/auth/logout",
              "host": ["{{base_url}}"],
              "path": ["auth", "logout"]
            },
            "description": "Cerrar sesi√≥n del usuario autenticado"
          }
        }
      ],
      "description": "Endpoints de autenticaci√≥n: login, registro, perfil y logout"
    },
    {
      "name": "üë• Users Management",
      "item": [
        {
          "name": "Listar Usuarios",
          "request": {
            "method": "GET",
            "header": [],
            "url": {
              "raw": "{{base_url}}/users?role=USER&search=juan&page=1&limit=10",
              "host": ["{{base_url}}"],
              "path": ["users"],
              "query": [
                {
                  "key": "role",
                  "value": "USER",
                  "description": "Filtrar por rol: USER, ADMIN, SUPER_ADMIN, MANAGER"
                },
                {
                  "key": "search",
                  "value": "juan",
                  "description": "B√∫squeda por nombre o email"
                },
                {
                  "key": "isActive",
                  "value": "true",
                  "disabled": true,
                  "description": "Filtrar por usuarios activos"
                },
                {
                  "key": "page",
                  "value": "1",
                  "description": "N√∫mero de p√°gina"
                },
                {
                  "key": "limit",
                  "value": "10",
                  "description": "Elementos por p√°gina"
                }
              ]
            },
            "description": "Obtener lista de usuarios con filtros y paginaci√≥n (requiere permisos de administrador)"
          }
        },
        {
          "name": "Obtener Usuario por ID",
          "request": {
            "method": "GET",
            "header": [],
            "url": {
              "raw": "{{base_url}}/users/{{user_id}}",
              "host": ["{{base_url}}"],
              "path": ["users", "{{user_id}}"]
            },
            "description": "Obtener detalles de un usuario espec√≠fico por ID"
          }
        },
        {
          "name": "Eliminar Usuario",
          "request": {
            "method": "DELETE",
            "header": [],
            "url": {
              "raw": "{{base_url}}/users/{{user_id}}",
              "host": ["{{base_url}}"],
              "path": ["users", "{{user_id}}"]
            },
            "description": "Eliminar un usuario espec√≠fico (soft delete - marca como inactivo)"
          }
        },
        {
          "name": "‚≠ê Upgrade a Premium",
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              },
              {
                "key": "Authorization",
                "value": "Bearer {{jwt_token}}"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"planType\": \"PREMIUM\",\n  \"paymentMethodId\": \"pm_card_visa_test\",\n  \"billingDetails\": {\n    \"name\": \"Juan Carlos P√©rez\",\n    \"email\": \"juan.perez@gmail.com\",\n    \"phone\": \"+52 33 1234 5678\",\n    \"address\": {\n      \"line1\": \"Av. L√≥pez Mateos 2375\",\n      \"city\": \"Guadalajara\",\n      \"state\": \"Jalisco\",\n      \"postal_code\": \"44550\",\n      \"country\": \"MX\"\n    }\n  }\n}"
            },
            "url": {
              "raw": "{{base_url}}/users/upgrade-premium",
              "host": ["{{base_url}}"],
              "path": ["users", "upgrade-premium"]
            },
            "description": "üÜï Actualizar usuario a suscripci√≥n premium con integraci√≥n completa de Stripe:\n\n**Planes Disponibles:**\n- **PREMIUM**: $299 MXN/mes\n- **PREMIUM_PLUS**: $499 MXN/mes\n- **ENTERPRISE**: $999 MXN/mes\n\n**Caracter√≠sticas:**\n- ‚úÖ Integraci√≥n real con Stripe (modo sandbox)\n- ‚úÖ Creaci√≥n autom√°tica de cliente Stripe\n- ‚úÖ Configuraci√≥n de m√©todo de pago predeterminado\n- ‚úÖ Suscripci√≥n recurrente autom√°tica\n- ‚úÖ Email de bienvenida premium autom√°tico\n- ‚úÖ Actualizaci√≥n inmediata del estado del usuario\n\n**Beneficios Premium:**\n- Reservaciones ilimitadas\n- Soporte prioritario 24/7\n- Acceso a ofertas exclusivas\n- Cancelaciones flexibles\n- Dashboard avanzado\n- Notificaciones personalizadas\n\n**Tarjetas de Prueba (Stripe Test):**\n- Visa: `4242424242424242`\n- Mastercard: `5555555555554444`\n- CVC: `123`, Fecha: cualquier fecha futura\n\n**Respuesta incluye:**\n- Informaci√≥n completa de la suscripci√≥n\n- Detalles del usuario actualizado\n- Datos de facturaci√≥n y pr√≥xima fecha de cobro"
          }
        }
      ],
      "description": "Gesti√≥n de usuarios del sistema"
    },
    {
      "name": "üè® Venues Management",
      "item": [
        {
          "name": "Listar Venues",
          "request": {
            "method": "GET",
            "header": [],
            "url": {
              "raw": "{{base_url}}/venues?category=ACCOMMODATION&search=hotel&city=Guadalajara&page=1&limit=10",
              "host": ["{{base_url}}"],
              "path": ["venues"],
              "query": [
                {
                  "key": "category",
                  "value": "ACCOMMODATION",
                  "description": "ACCOMMODATION, SPA, RESTAURANT, TOURISM, EVENT_SPACE"
                },
                {
                  "key": "search",
                  "value": "hotel",
                  "description": "B√∫squeda por nombre o descripci√≥n"
                },
                {
                  "key": "city",
                  "value": "Guadalajara",
                  "description": "Filtrar por ciudad"
                },
                {
                  "key": "isActive",
                  "value": "true",
                  "disabled": true,
                  "description": "Solo venues activos"
                },
                {
                  "key": "rating",
                  "value": "4",
                  "disabled": true,
                  "description": "Rating m√≠nimo (1-5)"
                },
                {
                  "key": "page",
                  "value": "1"
                },
                {
                  "key": "limit",
                  "value": "10"
                }
              ]
            },
            "description": "Obtener lista de venues con filtros avanzados"
          }
        },
        {
          "name": "Obtener Venue por ID",
          "request": {
            "method": "GET",
            "header": [],
            "url": {
              "raw": "{{base_url}}/venues/{{venue_id}}",
              "host": ["{{base_url}}"],
              "path": ["venues", "{{venue_id}}"]
            },
            "description": "Obtener detalles completos de un venue espec√≠fico"
          }
        },
        {
          "name": "Crear Nuevo Venue",
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"name\": \"Hotel Boutique Plaza\",\n  \"category\": \"ACCOMMODATION\",\n  \"description\": \"Hotel boutique en el centro hist√≥rico con servicio de primera clase\",\n  \"address\": \"Av. Hidalgo 123, Centro, Guadalajara, Jalisco\",\n  \"city\": \"Guadalajara\",\n  \"state\": \"Jalisco\",\n  \"country\": \"M√©xico\",\n  \"postalCode\": \"44100\",\n  \"latitude\": 20.6729,\n  \"longitude\": -103.3436,\n  \"phone\": \"+52 33 1234 5678\",\n  \"email\": \"contacto@hotelplaza.com\",\n  \"website\": \"https://hotelplaza.com\",\n  \"amenities\": [\"WiFi gratis\", \"Estacionamiento\", \"Aire acondicionado\", \"Room service\"],\n  \"images\": [\"https://ejemplo.com/hotel1.jpg\", \"https://ejemplo.com/hotel2.jpg\"],\n  \"priceRange\": {\n    \"min\": 1500,\n    \"max\": 4500,\n    \"currency\": \"MXN\"\n  },\n  \"policies\": {\n    \"checkIn\": \"15:00\",\n    \"checkOut\": \"11:00\",\n    \"cancellation\": \"Cancelaci√≥n gratuita hasta 24 horas antes\",\n    \"pets\": false,\n    \"smoking\": false\n  }\n}"
            },
            "url": {
              "raw": "{{base_url}}/venues",
              "host": ["{{base_url}}"],
              "path": ["venues"]
            },
            "description": "Crear un nuevo venue en la plataforma (requiere rol ADMIN o SUPER_ADMIN)"
          }
        }
      ],
      "description": "Gesti√≥n de venues (hoteles, spas, restaurantes, etc.)"
    },
    {
      "name": "üõéÔ∏è Services Management",
      "item": [
        {
          "name": "Listar Servicios",
          "request": {
            "method": "GET",
            "header": [],
            "url": {
              "raw": "{{base_url}}/services?venueId={{venue_id}}&category=ACCOMMODATION&isActive=true&page=1&limit=10",
              "host": ["{{base_url}}"],
              "path": ["services"],
              "query": [
                {
                  "key": "venueId",
                  "value": "{{venue_id}}",
                  "description": "ID del venue propietario"
                },
                {
                  "key": "category",
                  "value": "ACCOMMODATION",
                  "description": "Categor√≠a del servicio"
                },
                {
                  "key": "isActive",
                  "value": "true",
                  "description": "Solo servicios activos"
                },
                {
                  "key": "minPrice",
                  "value": "1000",
                  "disabled": true,
                  "description": "Precio m√≠nimo"
                },
                {
                  "key": "maxPrice",
                  "value": "5000",
                  "disabled": true,
                  "description": "Precio m√°ximo"
                },
                {
                  "key": "page",
                  "value": "1"
                },
                {
                  "key": "limit",
                  "value": "10"
                }
              ]
            },
            "description": "Obtener lista de servicios disponibles con filtros"
          }
        },
        {
          "name": "Obtener Servicio por ID",
          "request": {
            "method": "GET",
            "header": [],
            "url": {
              "raw": "{{base_url}}/services/{{service_id}}",
              "host": ["{{base_url}}"],
              "path": ["services", "{{service_id}}"]
            },
            "description": "Obtener detalles completos de un servicio espec√≠fico"
          }
        },
        {
          "name": "Crear Nuevo Servicio",
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"venueId\": \"{{venue_id}}\",\n  \"name\": \"Suite Presidential\",\n  \"category\": \"ACCOMMODATION\",\n  \"description\": \"Suite de lujo con vista panor√°mica de la ciudad\",\n  \"duration\": 1440,\n  \"capacity\": 4,\n  \"price\": 4500.00,\n  \"currency\": \"MXN\",\n  \"features\": [\"Vista panor√°mica\", \"Jacuzzi privado\", \"Balc√≥n amplio\", \"Servicio de mayordomo\"],\n  \"images\": [\"https://ejemplo.com/suite1.jpg\", \"https://ejemplo.com/suite2.jpg\"],\n  \"isActive\": true,\n  \"cancellationPolicy\": \"Cancelaci√≥n gratuita hasta 48 horas antes\",\n  \"availableHours\": {\n    \"start\": \"15:00\",\n    \"end\": \"11:00\"\n  }\n}"
            },
            "url": {
              "raw": "{{base_url}}/services",
              "host": ["{{base_url}}"],
              "path": ["services"]
            },
            "description": "Crear un nuevo servicio en un venue (requiere permisos de administrador del venue)"
          }
        }
      ],
      "description": "Gesti√≥n de servicios ofrecidos por los venues"
    },
    {
      "name": "üìÖ Reservations Management",
      "item": [
        {
          "name": "Listar Reservaciones",
          "request": {
            "method": "GET",
            "header": [],
            "url": {
              "raw": "{{base_url}}/reservations?status=CONFIRMED&dateFrom=2024-01-01&dateTo=2024-12-31&page=1&limit=10",
              "host": ["{{base_url}}"],
              "path": ["reservations"],
              "query": [
                {
                  "key": "status",
                  "value": "CONFIRMED",
                  "description": "PENDING, CONFIRMED, CANCELLED, COMPLETED"
                },
                {
                  "key": "dateFrom",
                  "value": "2024-01-01",
                  "description": "Fecha inicio en formato YYYY-MM-DD"
                },
                {
                  "key": "dateTo",
                  "value": "2024-12-31",
                  "description": "Fecha fin en formato YYYY-MM-DD"
                },
                {
                  "key": "serviceId",
                  "value": "{{service_id}}",
                  "disabled": true,
                  "description": "Filtrar por servicio espec√≠fico"
                },
                {
                  "key": "page",
                  "value": "1"
                },
                {
                  "key": "limit",
                  "value": "10"
                }
              ]
            },
            "description": "Obtener lista de reservaciones del usuario autenticado (usuarios ven sus reservas, admins ven todas)"
          }
        },
        {
          "name": "Obtener Reservaci√≥n por ID",
          "request": {
            "method": "GET",
            "header": [],
            "url": {
              "raw": "{{base_url}}/reservations/{{reservation_id}}",
              "host": ["{{base_url}}"],
              "path": ["reservations", "{{reservation_id}}"]
            },
            "description": "Obtener detalles completos de una reservaci√≥n espec√≠fica"
          }
        },
        {
          "name": "Crear Nueva Reservaci√≥n",
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"serviceId\": \"{{service_id}}\",\n  \"checkInDate\": \"2024-03-15\",\n  \"checkInTime\": \"15:00\",\n  \"checkOutDate\": \"2024-03-16\",\n  \"checkOutTime\": \"11:00\",\n  \"guests\": 2,\n  \"specialRequests\": \"Vista al jard√≠n preferible, cama king size\",\n  \"contactPhone\": \"+52 33 9876 5432\",\n  \"emergencyContact\": {\n    \"name\": \"Mar√≠a Gonz√°lez\",\n    \"phone\": \"+52 33 1111 2222\",\n    \"relationship\": \"Esposa\"\n  },\n  \"paymentInfo\": {\n    \"method\": \"STRIPE\",\n    \"paymentMethodId\": \"pm_card_visa_test\"\n  }\n}"
            },
            "url": {
              "raw": "{{base_url}}/reservations",
              "host": ["{{base_url}}"],
              "path": ["reservations"]
            },
            "description": "üÜï Crear una nueva reservaci√≥n con procesamiento real de pagos Stripe:\n\n**Integraci√≥n Completa de Stripe:**\n- ‚úÖ Payment Intent autom√°tico en Stripe\n- ‚úÖ Creaci√≥n autom√°tica de cliente Stripe si no existe\n- ‚úÖ Procesamiento inmediato del pago con tarjeta\n- ‚úÖ Registro completo en tabla Payment con stripePaymentId\n- ‚úÖ Estado de reserva autom√°tico basado en resultado del pago\n- ‚úÖ Emails autom√°ticos: confirmaci√≥n de reserva + confirmaci√≥n de pago\n\n**Estados Autom√°ticos:**\n- Pago exitoso ‚Üí Reserva CONFIRMED + emails enviados\n- Pago fallido ‚Üí Reserva PENDING + no emails\n\n**Datos de Prueba Stripe:**\n- Visa: `4242424242424242`\n- Mastercard: `5555555555554444`\n- CVC: `123`, Fecha: cualquier fecha futura\n\n**Respuesta incluye:**\n- Datos completos de la reserva\n- Informaci√≥n del pago creado\n- Payment Intent de Stripe con client_secret\n- Manejo de errores espec√≠ficos de Stripe\n\n**Campos Requeridos:**\n- `paymentInfo.paymentMethodId`: ID del m√©todo de pago de Stripe\n- Venue, servicio y fechas de check-in/out\n\n**IMPORTANTE:** Ahora los pagos S√ç se procesan realmente en Stripe (modo sandbox)"
          }
        },
        {
          "name": "‚ùå Cancelar Reservaci√≥n",
          "request": {
            "method": "PATCH",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              },
              {
                "key": "Authorization",
                "value": "Bearer {{jwt_token}}"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"reason\": \"Cambio de planes - cancelaci√≥n voluntaria del usuario\"\n}"
            },
            "url": {
              "raw": "{{base_url}}/reservations/{{reservation_id}}/cancel",
              "host": ["{{base_url}}"],
              "path": ["reservations", "{{reservation_id}}", "cancel"]
            },
            "description": "üÜï Cancelar una reservaci√≥n existente con c√°lculo autom√°tico de reembolso:\n\n**Pol√≠tica de Reembolso:**\n- M√°s de 48 horas antes: 100% reembolso\n- 24-48 horas antes: 50% reembolso  \n- Menos de 24 horas: Sin reembolso\n\n**Caracter√≠sticas:**\n- ‚úÖ Email autom√°tico de confirmaci√≥n de cancelaci√≥n\n- ‚úÖ Actualizaci√≥n autom√°tica del estado de la reserva\n- ‚úÖ C√°lculo de reembolso basado en pol√≠tica de tiempo\n- ‚úÖ Usuarios solo pueden cancelar sus propias reservas\n- ‚úÖ Admins pueden cancelar cualquier reserva\n\n**Respuesta incluye:**\n- Estado actualizado de la reserva\n- Monto de reembolso calculado\n- Fecha y raz√≥n de cancelaci√≥n\n- Estado del proceso de reembolso"
          }
        }
      ],
      "description": "Gesti√≥n completa de reservaciones"
    },
    {
      "name": "üìß Contact System",
      "item": [
        {
          "name": "Obtener Formularios de Contacto (Admin)",
          "request": {
            "method": "GET",
            "header": [],
            "url": {
              "raw": "{{base_url}}/contact?status=PENDING&page=1&limit=10",
              "host": ["{{base_url}}"],
              "path": ["contact"],
              "query": [
                {
                  "key": "status",
                  "value": "PENDING",
                  "description": "PENDING, RESPONDED, RESOLVED"
                },
                {
                  "key": "page",
                  "value": "1",
                  "description": "N√∫mero de p√°gina"
                },
                {
                  "key": "limit",
                  "value": "10",
                  "description": "Elementos por p√°gina"
                }
              ]
            },
            "description": "Obtener lista de formularios de contacto para administradores"
          }
        },
        {
          "name": "Enviar Formulario de Contacto",
          "request": {
            "auth": {
              "type": "noauth"
            },
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"name\": \"Juan P√©rez\",\n  \"email\": \"juan.perez@ejemplo.com\",\n  \"phone\": \"+52 33 1234 5678\",\n  \"subject\": \"Consulta sobre reservaciones grupales\",\n  \"message\": \"Hola, me gustar√≠a obtener informaci√≥n sobre tarifas especiales para reservaciones grupales de 15 personas. ¬øManejan descuentos por volumen? Gracias.\"\n}"
            },
            "url": {
              "raw": "{{base_url}}/contact",
              "host": ["{{base_url}}"],
              "path": ["contact"]
            },
            "description": "Enviar un formulario de contacto p√∫blico (no requiere autenticaci√≥n). Se env√≠an autom√°ticamente emails de notificaci√≥n."
          }
        },
        {
          "name": "Actualizar Estado Formulario",
          "request": {
            "method": "PATCH",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"id\": \"contact_form_123\",\n  \"status\": \"RESPONDED\",\n  \"notes\": \"Cliente contactado por tel√©fono, informaci√≥n enviada por email\"\n}"
            },
            "url": {
              "raw": "{{base_url}}/contact",
              "host": ["{{base_url}}"],
              "path": ["contact"]
            },
            "description": "Actualizar el estado de un formulario de contacto (solo administradores)"
          }
        }
      ],
      "description": "Sistema de formularios de contacto con emails autom√°ticos"
    },
    {
      "name": "üõ†Ô∏è Admin Management",
      "item": [
        {
          "name": "Dashboard Estad√≠sticas",
          "request": {
            "method": "GET",
            "header": [],
            "url": {
              "raw": "{{base_url}}/admin/stats",
              "host": ["{{base_url}}"],
              "path": ["admin", "stats"]
            },
            "description": "Obtener KPIs y estad√≠sticas del dashboard administrativo. SUPER_ADMIN ve todo, ADMIN ve solo sus venues."
          }
        },
        {
          "name": "Gesti√≥n de Pagos Admin",
          "request": {
            "method": "GET",
            "header": [],
            "url": {
              "raw": "{{base_url}}/admin/payments?status=COMPLETED&dateFrom=2024-01-01&dateTo=2024-12-31&page=1&limit=20",
              "host": ["{{base_url}}"],
              "path": ["admin", "payments"],
              "query": [
                {
                  "key": "status",
                  "value": "COMPLETED",
                  "description": "PENDING, COMPLETED, FAILED, REFUNDED"
                },
                {
                  "key": "dateFrom",
                  "value": "2024-01-01",
                  "description": "Fecha inicio filtro"
                },
                {
                  "key": "dateTo",
                  "value": "2024-12-31",
                  "description": "Fecha fin filtro"
                },
                {
                  "key": "venueId",
                  "value": "{{venue_id}}",
                  "disabled": true,
                  "description": "Filtrar por venue espec√≠fico"
                },
                {
                  "key": "page",
                  "value": "1"
                },
                {
                  "key": "limit",
                  "value": "20"
                }
              ]
            },
            "description": "Obtener lista de pagos para administradores con filtros avanzados"
          }
        },
        {
          "name": "Acciones de Pago Admin",
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"action\": \"refund\",\n  \"paymentId\": \"payment_123\",\n  \"amount\": 2250.00,\n  \"reason\": \"Solicitud de reembolso por cancelaci√≥n del cliente\",\n  \"adminNotes\": \"Cliente cancel√≥ por enfermedad, se procede con reembolso completo seg√∫n pol√≠tica\"\n}"
            },
            "url": {
              "raw": "{{base_url}}/admin/payments/actions",
              "host": ["{{base_url}}"],
              "path": ["admin", "payments", "actions"]
            },
            "description": "Ejecutar acciones administrativas sobre pagos: reembolsos, retries, etc."
          }
        },
        {
          "name": "Sistema de Logs - Listar",
          "request": {
            "method": "GET",
            "header": [],
            "url": {
              "raw": "{{base_url}}/admin/system-logs?level=ERROR&level=WARN&category=API_REQUEST&dateFrom=2024-08-01&page=1&limit=50",
              "host": ["{{base_url}}"],
              "path": ["admin", "system-logs"],
              "query": [
                {
                  "key": "level",
                  "value": "ERROR",
                  "description": "DEBUG, INFO, WARN, ERROR"
                },
                {
                  "key": "level",
                  "value": "WARN",
                  "description": "Se pueden agregar m√∫ltiples levels"
                },
                {
                  "key": "category",
                  "value": "API_REQUEST",
                  "description": "API_REQUEST, AUTHENTICATION, PAYMENT, DATABASE, SYSTEM"
                },
                {
                  "key": "eventType",
                  "value": "payment_failed",
                  "disabled": true,
                  "description": "Tipo espec√≠fico de evento"
                },
                {
                  "key": "userId",
                  "value": "{{user_id}}",
                  "disabled": true,
                  "description": "Filtrar por usuario espec√≠fico"
                },
                {
                  "key": "dateFrom",
                  "value": "2024-08-01",
                  "description": "Fecha inicio en formato YYYY-MM-DD"
                },
                {
                  "key": "dateTo",
                  "value": "2024-08-31",
                  "disabled": true,
                  "description": "Fecha fin en formato YYYY-MM-DD"
                },
                {
                  "key": "search",
                  "value": "error 500",
                  "disabled": true,
                  "description": "B√∫squeda de texto libre"
                },
                {
                  "key": "page",
                  "value": "1"
                },
                {
                  "key": "limit",
                  "value": "50"
                }
              ]
            },
            "description": "Obtener logs del sistema con filtros avanzados (solo SUPER_ADMIN)"
          }
        },
        {
          "name": "Sistema de Logs - Estad√≠sticas",
          "request": {
            "method": "GET",
            "header": [],
            "url": {
              "raw": "{{base_url}}/admin/system-logs/stats?dateFrom=2024-08-01&dateTo=2024-08-31",
              "host": ["{{base_url}}"],
              "path": ["admin", "system-logs", "stats"],
              "query": [
                {
                  "key": "dateFrom",
                  "value": "2024-08-01",
                  "description": "Fecha inicio para estad√≠sticas"
                },
                {
                  "key": "dateTo",
                  "value": "2024-08-31",
                  "description": "Fecha fin para estad√≠sticas"
                }
              ]
            },
            "description": "Obtener estad√≠sticas agregadas de logs del sistema"
          }
        },
        {
          "name": "Sistema de Logs - Limpiar",
          "request": {
            "method": "DELETE",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"olderThanDays\": 30,\n  \"levels\": [\"DEBUG\", \"INFO\"],\n  \"confirm\": true\n}"
            },
            "url": {
              "raw": "{{base_url}}/admin/system-logs/cleanup",
              "host": ["{{base_url}}"],
              "path": ["admin", "system-logs", "cleanup"]
            },
            "description": "Limpiar logs antiguos del sistema seg√∫n criterios especificados"
          }
        },
        {
          "name": "Sistema de Logs - Exportar",
          "request": {
            "method": "GET",
            "header": [],
            "url": {
              "raw": "{{base_url}}/admin/system-logs/export?format=csv&level=ERROR&dateFrom=2024-08-01&dateTo=2024-08-31",
              "host": ["{{base_url}}"],
              "path": ["admin", "system-logs", "export"],
              "query": [
                {
                  "key": "format",
                  "value": "csv",
                  "description": "Formato: csv, json"
                },
                {
                  "key": "level",
                  "value": "ERROR",
                  "description": "Filtrar por nivel de log"
                },
                {
                  "key": "dateFrom",
                  "value": "2024-08-01",
                  "description": "Fecha inicio"
                },
                {
                  "key": "dateTo",
                  "value": "2024-08-31",
                  "description": "Fecha fin"
                }
              ]
            },
            "description": "Exportar logs del sistema en formato CSV o JSON"
          }
        },
        {
          "name": "Notificaciones Admin - Listar",
          "request": {
            "method": "GET",
            "header": [],
            "url": {
              "raw": "{{base_url}}/admin/notifications?page=1&limit=20&category=email&level=all&type=RESERVATION_CONFIRMATION",
              "host": ["{{base_url}}"],
              "path": ["admin", "notifications"],
              "query": [
                {
                  "key": "page",
                  "value": "1",
                  "description": "N√∫mero de p√°gina"
                },
                {
                  "key": "limit",
                  "value": "20",
                  "description": "Elementos por p√°gina (m√°x: 100)"
                },
                {
                  "key": "isRead",
                  "value": "false",
                  "disabled": true,
                  "description": "Filtrar por estado de lectura (true/false)"
                },
                {
                  "key": "type",
                  "value": "RESERVATION_CONFIRMATION",
                  "description": "Tipo de notificaci√≥n espec√≠fico"
                },
                {
                  "key": "category",
                  "value": "email",
                  "description": "Categor√≠a: email (enviadas por email) o system (solo sistema)"
                },
                {
                  "key": "level",
                  "value": "all",
                  "description": "Nivel: all, unread, read"
                },
                {
                  "key": "startDate",
                  "value": "2024-01-01T00:00:00Z",
                  "disabled": true,
                  "description": "Fecha inicio (ISO string)"
                },
                {
                  "key": "endDate",
                  "value": "2024-12-31T23:59:59Z",
                  "disabled": true,
                  "description": "Fecha fin (ISO string)"
                },
                {
                  "key": "userId",
                  "value": "{{user_id}}",
                  "disabled": true,
                  "description": "Filtrar por usuario espec√≠fico"
                },
                {
                  "key": "search",
                  "value": "reserva",
                  "disabled": true,
                  "description": "B√∫squeda en t√≠tulo y mensaje"
                }
              ]
            },
            "description": "Ver todas las notificaciones enviadas v√≠a email y sistema. SUPER_ADMIN ve todas, ADMIN solo ve las relacionadas con sus venues/servicios."
          }
        },
        {
          "name": "Notificaciones Admin - Marcar como Le√≠da",
          "request": {
            "method": "PATCH",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"notificationIds\": [\"notification_123\", \"notification_456\"],\n  \"isRead\": true\n}"
            },
            "url": {
              "raw": "{{base_url}}/admin/notifications",
              "host": ["{{base_url}}"],
              "path": ["admin", "notifications"]
            },
            "description": "Marcar notificaciones como le√≠das o no le√≠das (operaci√≥n masiva). Solo se pueden actualizar notificaciones relacionadas con venues/servicios del admin."
          }
        },
        {
          "name": "Notificaciones Admin - Estad√≠sticas",
          "request": {
            "method": "GET",
            "header": [],
            "url": {
              "raw": "{{base_url}}/admin/notifications/stats?period=month&startDate=2024-01-01&endDate=2024-12-31",
              "host": ["{{base_url}}"],
              "path": ["admin", "notifications", "stats"],
              "query": [
                {
                  "key": "period",
                  "value": "month",
                  "description": "Per√≠odo: today, week, month, year"
                },
                {
                  "key": "startDate",
                  "value": "2024-01-01",
                  "disabled": true,
                  "description": "Fecha inicio personalizada (ISO string)"
                },
                {
                  "key": "endDate",
                  "value": "2024-12-31",
                  "disabled": true,
                  "description": "Fecha fin personalizada (ISO string)"
                }
              ]
            },
            "description": "üÜï Obtener estad√≠sticas completas de notificaciones: totales, por tipo, por d√≠a, usuarios m√°s activos, tipos de email. SUPER_ADMIN ve todo, ADMIN solo sus venues. Compatible con el nuevo m√≥dulo de gesti√≥n de notificaciones implementado."
          }
        }
      ],
      "description": "Endpoints administrativos avanzados: estad√≠sticas, pagos, logs del sistema, gesti√≥n de notificaciones"
    },
    {
      "name": "üí≥ Payments & Subscription",
      "item": [
        {
          "name": "Crear Suscripci√≥n Premium",
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"priceId\": \"price_premium_monthly\",\n  \"paymentMethodId\": \"pm_card_visa_test\",\n  \"businessInfo\": {\n    \"businessName\": \"Hotel Boutique Plaza\",\n    \"businessType\": \"ACCOMMODATION\",\n    \"taxId\": \"RFC123456789\",\n    \"address\": {\n      \"street\": \"Av. Hidalgo 123\",\n      \"city\": \"Guadalajara\",\n      \"state\": \"Jalisco\",\n      \"postalCode\": \"44100\",\n      \"country\": \"M√©xico\"\n    }\n  }\n}"
            },
            "url": {
              "raw": "{{base_url}}/payments/subscription",
              "host": ["{{base_url}}"],
              "path": ["payments", "subscription"]
            },
            "description": "Crear suscripci√≥n premium para usuarios business con Stripe"
          }
        }
      ],
      "description": "Sistema de pagos y suscripciones con Stripe"
    },
    {
      "name": "üîî Notifications",
      "item": [
        {
          "name": "Listar Notificaciones",
          "request": {
            "method": "GET",
            "header": [],
            "url": {
              "raw": "{{base_url}}/notifications?unread=false&type=BOOKING_CONFIRMED&page=1&limit=20",
              "host": ["{{base_url}}"],
              "path": ["notifications"],
              "query": [
                {
                  "key": "unread",
                  "value": "false",
                  "description": "true para solo no le√≠das, false para todas"
                },
                {
                  "key": "type",
                  "value": "BOOKING_CONFIRMED",
                  "description": "Tipo espec√≠fico de notificaci√≥n"
                },
                {
                  "key": "page",
                  "value": "1"
                },
                {
                  "key": "limit",
                  "value": "20"
                }
              ]
            },
            "description": "üÜï Obtener notificaciones del usuario autenticado con filtros avanzados:\n\n**Funcionalidades:**\n- ‚úÖ Filtrado por estado de lectura (unread=true/false)\n- ‚úÖ Filtrado por tipo de notificaci√≥n\n- ‚úÖ Paginaci√≥n completa con l√≠mites\n- ‚úÖ Contador de notificaciones no le√≠das\n- ‚úÖ Ordenamiento por fecha de creaci√≥n (m√°s recientes primero)\n\n**Tipos de Notificaci√≥n:**\n- `RESERVATION_CONFIRMATION` - Confirmaciones de reserva\n- `PAYMENT_CONFIRMATION` - Confirmaciones de pago\n- `RESERVATION_CANCELLATION` - Cancelaciones de reserva\n\n**Par√°metros de Filtrado:**\n- `unread`: `true` (solo no le√≠das), `false` (solo le√≠das), omitir (todas)\n- `type`: Filtrar por tipo espec√≠fico\n- `page`: N√∫mero de p√°gina (default: 1)\n- `limit`: Elementos por p√°gina (default: 20, m√°ximo: 100)\n\n**Respuesta incluye:**\n- Array de notificaciones con metadata completa\n- Informaci√≥n de paginaci√≥n\n- Contador de notificaciones no le√≠das\n- Timestamps de creaci√≥n y actualizaci√≥n\n\n**Ejemplos de Uso:**\n- Solo no le√≠das: `?unread=true`\n- Solo confirmaciones: `?type=RESERVATION_CONFIRMATION`\n- Paginado: `?page=1&limit=10`\n\n**Autenticaci√≥n:** Requiere JWT token de usuario"
          }
        },
        {
          "name": "Crear Notificaci√≥n",
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              },
              {
                "key": "Authorization",
                "value": "Bearer {{jwt_token}}"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"userId\": \"{{user_id}}\",\n  \"type\": \"RESERVATION_CONFIRMATION\",\n  \"title\": \"üéâ ¬°Reserva confirmada!\",\n  \"message\": \"Tu reserva en Hotel Plaza para Suite Deluxe ha sido confirmada. C√≥digo: RES123ABC\",\n  \"metadata\": {\n    \"reservationId\": \"res_123\",\n    \"confirmationId\": \"RES123ABC\",\n    \"venueName\": \"Hotel Plaza\",\n    \"serviceName\": \"Suite Deluxe\",\n    \"checkInDate\": \"2025-03-15T15:00:00Z\",\n    \"totalAmount\": 2500\n  }\n}"
            },
            "url": {
              "raw": "{{base_url}}/notifications",
              "host": ["{{base_url}}"],
              "path": ["notifications"]
            },
            "description": "üÜï Crear nueva notificaci√≥n para un usuario espec√≠fico:\n\n**Casos de Uso:**\n- Administradores enviando notificaciones manuales\n- Sistema automatizado creando notificaciones\n- Integraciones externas notificando usuarios\n\n**Validaciones:**\n- Tipo de notificaci√≥n v√°lido\n- Usuario destinatario debe existir\n- Campos requeridos: userId, type, title, message\n\n**Tipos V√°lidos:**\n- `RESERVATION_CONFIRMATION`\n- `PAYMENT_CONFIRMATION` \n- `RESERVATION_CANCELLATION`\n\n**Metadata Opcional:**\n- Informaci√≥n adicional espec√≠fica del tipo\n- Datos de reserva, pago, etc.\n- Formato JSON flexible\n\n**Respuesta:**\n- Notificaci√≥n creada con informaci√≥n completa\n- Datos del usuario destinatario\n- ID √∫nico de la notificaci√≥n\n\n**Automatizaci√≥n:**\nEste endpoint es usado autom√°ticamente por:\n- Creaci√≥n de reservas (‚Üí RESERVATION_CONFIRMATION)\n- Procesamiento de pagos (‚Üí PAYMENT_CONFIRMATION)\n- Cancelaci√≥n de reservas (‚Üí RESERVATION_CANCELLATION)"
          }
        },
        {
          "name": "Marcar Notificaciones como Le√≠das",
          "request": {
            "method": "PATCH",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              },
              {
                "key": "Authorization",
                "value": "Bearer {{jwt_token}}"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"notificationIds\": [\"notification_id_1\", \"notification_id_2\"]\n}"
            },
            "url": {
              "raw": "{{base_url}}/notifications",
              "host": ["{{base_url}}"],
              "path": ["notifications"]
            },
            "description": "üÜï Marcar notificaciones como le√≠das:\n\n**Opciones de Marcado:**\n\n1. **Notificaciones espec√≠ficas:**\n```json\n{\n  \"notificationIds\": [\"notif_123\", \"notif_456\"]\n}\n```\n\n2. **Todas las notificaciones no le√≠das:**\n```json\n{\n  \"markAllAsRead\": true\n}\n```\n\n**Seguridad:**\n- Solo puede marcar notificaciones propias\n- Validaci√≥n de permisos autom√°tica\n- Filtrado por userId del token JWT\n\n**Respuesta:**\n- Contador de notificaciones actualizadas\n- Mensaje de confirmaci√≥n\n- Estado de la operaci√≥n\n\n**Casos de Uso:**\n- Usuario marca notificaciones individuales\n- Funci√≥n \"Marcar todas como le√≠das\"\n- Apps m√≥viles sincronizando estado\n- Limpieza autom√°tica de notificaciones\n\n**UX Recomendada:**\n- Marcar como le√≠da al abrir/ver\n- Bot√≥n para marcar todas\n- Indicador visual de no le√≠das\n- Sincronizaci√≥n entre dispositivos"
          }
        }
      ],
      "description": "üÜï Sistema completo de notificaciones en tiempo real con funcionalidad completa:\n\n**Caracter√≠sticas:**\n- ‚úÖ Creaci√≥n autom√°tica en reservas y pagos\n- ‚úÖ Filtrado avanzado y paginaci√≥n\n- ‚úÖ Gesti√≥n de estado de lectura\n- ‚úÖ Tipos espec√≠ficos con metadata\n- ‚úÖ Seguridad por usuario\n- ‚úÖ API completa (GET, POST, PATCH)\n\n**Datos de Prueba:**\nJuan P√©rez (juan.perez@gmail.com) tiene 5 notificaciones de ejemplo creadas autom√°ticamente para testing."
    },
    {
      "name": "üì± Mobile API",
      "item": [
        {
          "name": "Dashboard Usuario M√≥vil",
          "event": [
            {
              "listen": "test",
              "script": {
                "type": "text/javascript",
                "exec": [
                  "// Validar estructura del dashboard m√≥vil",
                  "pm.test('‚úÖ Mobile dashboard structure is correct', function () {",
                  "    const response = pm.response.json();",
                  "    pm.expect(response.success).to.be.true;",
                  "    pm.expect(response.data).to.exist;",
                  "    ",
                  "    const data = response.data;",
                  "    pm.expect(data.user).to.exist;",
                  "    pm.expect(data.statistics).to.exist;",
                  "    pm.expect(data.favoriteVenues).to.be.an('array');",
                  "    pm.expect(data.recentReservations).to.be.an('array');",
                  "});",
                  "",
                  "pm.test('üìä Statistics contain required fields', function () {",
                  "    const stats = pm.response.json().data.statistics;",
                  "    pm.expect(stats.totalReservations).to.be.a('number');",
                  "    pm.expect(stats.upcomingReservations).to.be.a('number');",
                  "    pm.expect(stats.completedReservations).to.be.a('number');",
                  "    pm.expect(stats.favoriteVenues).to.be.a('number');",
                  "    pm.expect(stats.totalSpent).to.exist;",
                  "    pm.expect(stats.unreadNotifications).to.be.a('number');",
                  "});",
                  "",
                  "// Log de estad√≠sticas para debugging",
                  "const dashboardData = pm.response.json().data;",
                  "console.log('üì± Dashboard Data Summary:');",
                  "console.log('üë§ Usuario:', dashboardData.user.firstName, dashboardData.user.lastName);",
                  "console.log('üìä Total reservaciones:', dashboardData.statistics.totalReservations);",
                  "console.log('‚è∞ Pr√≥ximas:', dashboardData.statistics.upcomingReservations);",
                  "console.log('‚úÖ Completadas:', dashboardData.statistics.completedReservations);",
                  "console.log('üíñ Favoritos:', dashboardData.statistics.favoriteVenues);",
                  "console.log('üí∞ Total gastado:', dashboardData.statistics.totalSpent);",
                  "console.log('üîî Notificaciones no le√≠das:', dashboardData.statistics.unreadNotifications);"
                ]
              }
            }
          ],
          "request": {
            "method": "GET",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "url": {
              "raw": "{{base_url}}/mobile/user/dashboard",
              "host": ["{{base_url}}"],
              "path": ["mobile", "user", "dashboard"]
            },
            "description": "Obtener dashboard completo para aplicaci√≥n m√≥vil del usuario autenticado. Incluye estad√≠sticas, pr√≥ximas reservaciones, favoritos y m√°s. Este endpoint est√° optimizado para apps m√≥viles con toda la informaci√≥n necesaria en una sola llamada.\n\n**Funcionalidades:**\n- üìä Estad√≠sticas del usuario (reservaciones, gastos, favoritos)\n- üè® Pr√≥xima reservaci√≥n con detalles completos\n- üìÖ Historial de reservaciones recientes (√∫ltimas 5)\n- üíñ Lista de lugares favoritos con stats\n- üîî Contador de notificaciones no le√≠das\n- üë§ Informaci√≥n b√°sica del usuario\n\n**Datos retornados:**\n- Total de reservaciones, pr√≥ximas, completadas\n- Total gastado en la plataforma\n- Lugares favoritos con informaci√≥n detallada\n- Pr√≥xima reservaci√≥n programada\n- Reservaciones recientes con venue y servicio\n\n**Usuario demo:** `juan.perez@gmail.com` tiene datos completos para testing."
          }
        }
      ],
      "description": "Endpoints espec√≠ficos para aplicaciones m√≥viles con datos optimizados"
    },
    {
      "name": "‚ùå Cancelaciones & Reembolsos",
      "item": [
        {
          "name": "Cancelar Reservaci√≥n",
          "event": [
            {
              "listen": "test",
              "script": {
                "type": "text/javascript",
                "exec": [
                  "// Validar cancelaci√≥n exitosa",
                  "pm.test('‚úÖ Cancellation successful', function () {",
                  "    pm.expect(pm.response.code).to.equal(200);",
                  "    const response = pm.response.json();",
                  "    pm.expect(response.success).to.be.true;",
                  "    pm.expect(response.data).to.exist;",
                  "});",
                  "",
                  "pm.test('üìã Cancellation data structure', function () {",
                  "    const data = pm.response.json().data;",
                  "    pm.expect(data.status).to.equal('CANCELLED');",
                  "    pm.expect(data.cancelledAt).to.exist;",
                  "    pm.expect(data.cancelReason).to.exist;",
                  "    pm.expect(data.refundAmount).to.exist;",
                  "    pm.expect(data.refundStatus).to.exist;",
                  "});",
                  "",
                  "// Log cancellation details",
                  "const cancelData = pm.response.json().data;",
                  "console.log('‚ùå Cancellation Details:');",
                  "console.log('üÜî Reservation ID:', cancelData.reservationId);",
                  "console.log('üìÖ Cancelled At:', cancelData.cancelledAt);",
                  "console.log('üìù Reason:', cancelData.cancelReason);",
                  "console.log('üí∞ Refund Amount:', cancelData.refundAmount);",
                  "console.log('üîÑ Refund Status:', cancelData.refundStatus);"
                ]
              }
            }
          ],
          "request": {
            "method": "PATCH",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"reason\": \"Cambio de planes por emergencia familiar\"\n}"
            },
            "url": {
              "raw": "{{base_url}}/reservations/{{reservation_id}}/cancel",
              "host": ["{{base_url}}"],
              "path": ["reservations", "{{reservation_id}}", "cancel"]
            },
            "description": "Cancelar una reservaci√≥n existente con c√°lculo autom√°tico de reembolso basado en pol√≠tica de cancelaci√≥n.\\n\\n**Pol√≠tica de Reembolso:**\\n- ‚è∞ M√°s de 48 horas antes: 100% reembolso\\n- üïê 24-48 horas antes: 50% reembolso\\n- ‚ö†Ô∏è Menos de 24 horas: Sin reembolso\\n\\n**Funcionalidades:**\\n- ‚úÖ Validaci√≥n de permisos (usuario propietario o admin)\\n- üí∞ C√°lculo autom√°tico de reembolso\\n- üìß Email de confirmaci√≥n autom√°tico\\n- üîÑ Actualizaci√≥n de estado en base de datos\\n- üí≥ Procesamiento de reembolso (integraci√≥n con Stripe)\\n\\n**Respuesta incluye:**\\n- Estado actualizado de la reservaci√≥n\\n- Monto y estado del reembolso\\n- Fecha y raz√≥n de cancelaci√≥n\\n- ID de confirmaci√≥n para seguimiento"
          }
        }
      ],
      "description": "Gesti√≥n de cancelaciones de reservaciones con reembolsos autom√°ticos"
    },
    {
      "name": "‚≠ê Premium & Suscripciones",
      "item": [
        {
          "name": "Upgrade a Premium",
          "event": [
            {
              "listen": "test",
              "script": {
                "type": "text/javascript",
                "exec": [
                  "// Validar upgrade exitoso",
                  "pm.test('‚úÖ Premium upgrade successful', function () {",
                  "    pm.expect(pm.response.code).to.equal(200);",
                  "    const response = pm.response.json();",
                  "    pm.expect(response.success).to.be.true;",
                  "    pm.expect(response.data).to.exist;",
                  "});",
                  "",
                  "pm.test('üë§ User is now premium', function () {",
                  "    const user = pm.response.json().data.user;",
                  "    pm.expect(user.isPremium).to.be.true;",
                  "});",
                  "",
                  "pm.test('üìã Subscription data structure', function () {",
                  "    const subscription = pm.response.json().data.subscription;",
                  "    pm.expect(subscription.stripeSubscriptionId).to.exist;",
                  "    pm.expect(subscription.status).to.exist;",
                  "    pm.expect(subscription.planType).to.exist;",
                  "    pm.expect(subscription.amount).to.exist;",
                  "    pm.expect(subscription.currentPeriodEnd).to.exist;",
                  "});",
                  "",
                  "// Log premium upgrade details",
                  "const upgradeData = pm.response.json().data;",
                  "console.log('‚≠ê Premium Upgrade Details:');",
                  "console.log('üë§ User:', upgradeData.user.firstName, upgradeData.user.lastName);",
                  "console.log('üì¶ Plan:', upgradeData.subscription.planType);",
                  "console.log('üí∞ Amount:', upgradeData.subscription.amount, upgradeData.subscription.currency);",
                  "console.log('üîÑ Status:', upgradeData.subscription.status);",
                  "console.log('üìÖ Next Billing:', upgradeData.subscription.currentPeriodEnd);"
                ]
              }
            }
          ],
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"planType\": \"PREMIUM\",\n  \"paymentMethodId\": \"pm_card_visa\",\n  \"billingDetails\": {\n    \"name\": \"Juan P√©rez\",\n    \"email\": \"juan.perez@gmail.com\",\n    \"phone\": \"+52 33 1234 5678\"\n  }\n}"
            },
            "url": {
              "raw": "{{base_url}}/users/upgrade-premium",
              "host": ["{{base_url}}"],
              "path": ["users", "upgrade-premium"]
            },
            "description": "Actualizar usuario a plan premium con integraci√≥n real de Stripe (sandbox).\\n\\n**Planes Disponibles:**\\n- üíé **PREMIUM**: $299 MXN/mes\\n- üöÄ **PREMIUM_PLUS**: $499 MXN/mes\\n- üè¢ **ENTERPRISE**: $999 MXN/mes\\n\\n**Funcionalidades:**\\n- üí≥ Integraci√≥n real con Stripe (sandbox)\\n- üîí Validaci√≥n de m√©todo de pago\\n- üë§ Creaci√≥n autom√°tica de customer en Stripe\\n- üìß Email de bienvenida premium\\n- üíæ Guardado de suscripci√≥n en base de datos\\n- ‚≠ê Actualizaci√≥n inmediata a usuario premium\\n\\n**Beneficios Premium:**\\n- ‚úÖ Reservaciones ilimitadas\\n- üéß Soporte prioritario 24/7\\n- üéÅ Acceso a ofertas exclusivas\\n- üîÑ Cancelaciones flexibles\\n- üìä Dashboard avanzado\\n- üîî Notificaciones personalizadas\\n\\n**Datos de prueba Stripe:**\\n- **Visa**: `4242424242424242`\\n- **Mastercard**: `5555555555554444`\\n- **CVC**: `123`\\n- **Fecha**: Cualquier fecha futura"
          }
        }
      ],
      "description": "Gesti√≥n de suscripciones premium con Stripe real (sandbox)"
    },
    {
      "name": "‚öôÔ∏è System Health & Utils",
      "item": [
        {
          "name": "Health Check",
          "request": {
            "auth": {
              "type": "noauth"
            },
            "method": "GET",
            "header": [],
            "url": {
              "raw": "{{base_url}}/health",
              "host": ["{{base_url}}"],
              "path": ["health"]
            },
            "description": "Verificar estado de la API y servicios conectados (base de datos, Stripe, Resend, etc.)"
          }
        },
        {
          "name": "API Documentation (Swagger)",
          "request": {
            "auth": {
              "type": "noauth"
            },
            "method": "GET",
            "header": [],
            "url": {
              "raw": "{{base_url}}/swagger",
              "host": ["{{base_url}}"],
              "path": ["swagger"]
            },
            "description": "Obtener documentaci√≥n completa de la API en formato OpenAPI/Swagger"
          }
        }
      ],
      "description": "Herramientas de monitoreo y documentaci√≥n del sistema"
    },
    {
      "name": "üí∞ Payments & Receipts (Users)",
      "item": [
        {
          "name": "Get User Payments",
          "request": {
            "method": "GET",
            "header": [
              {
                "key": "Authorization",
                "value": "Bearer {{jwt_token}}",
                "type": "text"
              }
            ],
            "url": {
              "raw": "{{base_url}}/payments?page=1&limit=20&status=COMPLETED&type=reservation",
              "host": ["{{base_url}}"],
              "path": ["payments"],
              "query": [
                {"key": "page", "value": "1", "description": "Page number"},
                {"key": "limit", "value": "20", "description": "Items per page (max 50)"},
                {"key": "status", "value": "COMPLETED", "description": "Filter by status: PENDING, COMPLETED, FAILED, REFUNDED"},
                {"key": "type", "value": "reservation", "description": "reservation, subscription, business"},
                {"key": "startDate", "value": "2025-01-01", "disabled": true, "description": "Start date filter"},
                {"key": "endDate", "value": "2025-01-31", "disabled": true, "description": "End date filter"}
              ]
            },
            "description": "üÜï Obtener historial de pagos del usuario autenticado con filtros avanzados:\n\n**Funcionalidades:**\n- ‚úÖ Paginaci√≥n completa\n- ‚úÖ Filtros por estado, tipo y fechas\n- ‚úÖ Informaci√≥n detallada de cada pago\n- ‚úÖ Integraci√≥n con Stripe\n- ‚úÖ Historial completo de transacciones\n\n**Tipos de Pago:**\n- `reservation`: Pagos por reservaciones\n- `subscription`: Pagos por suscripciones premium\n- `business`: Pagos empresariales\n\n**Estados:**\n- `PENDING`: Pago pendiente\n- `COMPLETED`: Pago completado\n- `FAILED`: Pago fallido\n- `REFUNDED`: Pago reembolsado\n\n**Respuesta incluye:**\n- Detalles del pago con Stripe ID\n- Informaci√≥n de la reserva asociada\n- Estado del reembolso si aplica\n- M√©todo de pago utilizado"
          }
        },
        {
          "name": "Get Payment Details",
          "request": {
            "method": "GET",
            "header": [
              {
                "key": "Authorization",
                "value": "Bearer {{jwt_token}}",
                "type": "text"
              }
            ],
            "url": {
              "raw": "{{base_url}}/payments/{{payment_id}}",
              "host": ["{{base_url}}"],
              "path": ["payments", "{{payment_id}}"]
            },
            "description": "Obtener detalles completos de un pago espec√≠fico del usuario autenticado"
          }
        },
        {
          "name": "Cancel Payment",
          "request": {
            "method": "PATCH",
            "header": [
              {
                "key": "Authorization",
                "value": "Bearer {{jwt_token}}",
                "type": "text"
              },
              {
                "key": "Content-Type",
                "value": "application/json",
                "type": "text"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"action\": \"cancel\",\n  \"reason\": \"User cancellation - change of plans\"\n}"
            },
            "url": {
              "raw": "{{base_url}}/payments/{{payment_id}}",
              "host": ["{{base_url}}"],
              "path": ["payments", "{{payment_id}}"]
            },
            "description": "Cancelar un pago espec√≠fico (solo pagos en estado PENDING)"
          }
        },
        {
          "name": "Get User Receipts",
          "request": {
            "method": "GET",
            "header": [
              {
                "key": "Authorization",
                "value": "Bearer {{jwt_token}}",
                "type": "text"
              }
            ],
            "url": {
              "raw": "{{base_url}}/receipts?page=1&limit=20&type=PAYMENT&status=VERIFIED",
              "host": ["{{base_url}}"],
              "path": ["receipts"],
              "query": [
                {"key": "page", "value": "1", "description": "Page number"},
                {"key": "limit", "value": "20", "description": "Items per page"},
                {"key": "type", "value": "PAYMENT", "description": "PAYMENT, INVOICE, REFUND, CREDIT_NOTE"},
                {"key": "status", "value": "VERIFIED", "description": "PENDING, VERIFIED, REJECTED"},
                {"key": "paymentId", "value": "payment_123", "disabled": true, "description": "Filter by payment ID"}
              ]
            },
            "description": "üÜï Obtener recibos y facturas del usuario:\n\n**Tipos de Recibo:**\n- `PAYMENT`: Recibos de pago\n- `INVOICE`: Facturas generadas\n- `REFUND`: Comprobantes de reembolso\n- `CREDIT_NOTE`: Notas de cr√©dito\n\n**Estados:**\n- `PENDING`: En procesamiento\n- `VERIFIED`: Verificado y v√°lido\n- `REJECTED`: Rechazado\n\n**Funcionalidades:**\n- ‚úÖ Filtrado por tipo y estado\n- ‚úÖ Paginaci√≥n completa\n- ‚úÖ Descarga de PDFs\n- ‚úÖ Informaci√≥n fiscal completa"
          }
        },
        {
          "name": "Get Receipt Details",
          "request": {
            "method": "GET",
            "header": [
              {
                "key": "Authorization",
                "value": "Bearer {{jwt_token}}",
                "type": "text"
              }
            ],
            "url": {
              "raw": "{{base_url}}/receipts/{{receipt_id}}",
              "host": ["{{base_url}}"],
              "path": ["receipts", "{{receipt_id}}"]
            },
            "description": "Obtener detalles completos de un recibo espec√≠fico"
          }
        },
        {
          "name": "Download Receipt PDF",
          "request": {
            "method": "GET",
            "header": [
              {
                "key": "Authorization",
                "value": "Bearer {{jwt_token}}",
                "type": "text"
              }
            ],
            "url": {
              "raw": "{{base_url}}/receipts/{{receipt_id}}/download",
              "host": ["{{base_url}}"],
              "path": ["receipts", "{{receipt_id}}", "download"]
            },
            "description": "üÜï Descargar recibo en formato PDF:\n\n**Caracter√≠sticas:**\n- ‚úÖ Generaci√≥n autom√°tica de PDF\n- ‚úÖ Informaci√≥n fiscal completa\n- ‚úÖ Datos de Stripe integrados\n- ‚úÖ Formato profesional\n- ‚úÖ Descarga directa\n\n**Contenido del PDF:**\n- Datos del usuario y empresa\n- Detalles del pago\n- Informaci√≥n fiscal\n- C√≥digos QR para verificaci√≥n\n- Logo de ReservApp"
          }
        },
        {
          "name": "Request New Receipt",
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Authorization",
                "value": "Bearer {{jwt_token}}",
                "type": "text"
              },
              {
                "key": "Content-Type",
                "value": "application/json",
                "type": "text"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"paymentId\": \"{{payment_id}}\",\n  \"type\": \"PAYMENT\",\n  \"metadata\": {\n    \"requestReason\": \"Tax purposes - annual filing\"\n  }\n}"
            },
            "url": {
              "raw": "{{base_url}}/receipts",
              "host": ["{{base_url}}"],
              "path": ["receipts"]
            },
            "description": "Solicitar la generaci√≥n de un nuevo recibo para un pago existente"
          }
        }
      ],
      "description": "üÜï Sistema completo de gesti√≥n de pagos y recibos para usuarios finales con integraci√≥n Stripe"
    },
    {
      "name": "üîß Admin Payments & Invoices",
      "item": [
        {
          "name": "Get All Payments (Admin)",
          "request": {
            "method": "GET",
            "header": [
              {
                "key": "Authorization",
                "value": "Bearer {{jwt_token}}",
                "type": "text"
              }
            ],
            "url": {
              "raw": "{{base_url}}/admin/payments?page=1&limit=20&status=ALL&search=juan",
              "host": ["{{base_url}}"],
              "path": ["admin", "payments"],
              "query": [
                {"key": "page", "value": "1", "description": "Page number"},
                {"key": "limit", "value": "20", "description": "Items per page"},
                {"key": "status", "value": "ALL", "description": "COMPLETED, PENDING, FAILED, etc."},
                {"key": "search", "value": "juan", "description": "Search by user name/email"},
                {"key": "venueId", "value": "venue_123", "disabled": true, "description": "Filter by venue"},
                {"key": "startDate", "value": "2025-01-01", "disabled": true, "description": "Start date"},
                {"key": "endDate", "value": "2025-01-31", "disabled": true, "description": "End date"}
              ]
            },
            "description": "üÜï Panel administrativo de pagos con funcionalidades avanzadas:\n\n**Permisos por Rol:**\n- **SUPER_ADMIN**: Ve todos los pagos del sistema\n- **ADMIN**: Solo pagos de sus venues\n\n**Filtros Avanzados:**\n- ‚úÖ B√∫squeda por nombre/email de usuario\n- ‚úÖ Filtro por estado de pago\n- ‚úÖ Filtro por venue espec√≠fico\n- ‚úÖ Filtro por rango de fechas\n- ‚úÖ Paginaci√≥n optimizada\n\n**Informaci√≥n Detallada:**\n- Datos completos del usuario\n- Informaci√≥n de la reserva\n- Estado del pago en Stripe\n- Detalles del venue y servicio\n- Historial de reembolsos"
          }
        },
        {
          "name": "Get Payment Statistics (Admin)",
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Authorization",
                "value": "Bearer {{jwt_token}}",
                "type": "text"
              },
              {
                "key": "Content-Type",
                "value": "application/json",
                "type": "text"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"action\": \"getStats\",\n  \"filters\": {\n    \"startDate\": \"2025-01-01\",\n    \"endDate\": \"2025-01-31\",\n    \"venueId\": \"venue_123\"\n  }\n}"
            },
            "url": {
              "raw": "{{base_url}}/admin/payments",
              "host": ["{{base_url}}"],
              "path": ["admin", "payments"]
            },
            "description": "Obtener estad√≠sticas detalladas de pagos para dashboard administrativo"
          }
        },
        {
          "name": "Refund Payment (Admin)",
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Authorization",
                "value": "Bearer {{jwt_token}}",
                "type": "text"
              },
              {
                "key": "Content-Type",
                "value": "application/json",
                "type": "text"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"action\": \"refund\",\n  \"paymentId\": \"{{payment_id}}\",\n  \"amount\": 100.00,\n  \"reason\": \"Customer request - unsatisfactory service\",\n  \"notes\": \"Processed by admin due to customer complaint\"\n}"
            },
            "url": {
              "raw": "{{base_url}}/admin/payments/actions",
              "host": ["{{base_url}}"],
              "path": ["admin", "payments", "actions"]
            },
            "description": "üÜï Procesar reembolsos administrativos:\n\n**Caracter√≠sticas:**\n- ‚úÖ Reembolso parcial o total\n- ‚úÖ Integraci√≥n real con Stripe\n- ‚úÖ Notas administrativas\n- ‚úÖ Registro de auditor√≠a\n- ‚úÖ Notificaci√≥n autom√°tica al usuario\n\n**Validaciones:**\n- Solo pagos completados pueden reembolsarse\n- Monto no puede exceder el pago original\n- Requiere permisos administrativos\n- Genera registro en sistema de logs"
          }
        },
        {
          "name": "Generate Stripe Invoice",
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Authorization",
                "value": "Bearer {{jwt_token}}",
                "type": "text"
              },
              {
                "key": "Content-Type",
                "value": "application/json",
                "type": "text"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"description\": \"Factura por servicios premium - ReservApp\",\n  \"dueDate\": \"2025-02-15T00:00:00.000Z\",\n  \"autoFinalize\": true,\n  \"metadata\": {\n    \"invoiceType\": \"service_charge\",\n    \"departmentCode\": \"premium_services\"\n  }\n}"
            },
            "url": {
              "raw": "{{base_url}}/admin/payments/{{payment_id}}/invoice",
              "host": ["{{base_url}}"],
              "path": ["admin", "payments", "{{payment_id}}", "invoice"]
            },
            "description": "üÜï Generar facturas oficiales con Stripe:\n\n**Funcionalidades:**\n- ‚úÖ Generaci√≥n autom√°tica en Stripe\n- ‚úÖ Informaci√≥n fiscal completa\n- ‚úÖ Descarga en PDF\n- ‚úÖ Env√≠o autom√°tico por email\n- ‚úÖ Cumplimiento fiscal mexicano\n\n**Casos de Uso:**\n- Facturas para empresas\n- Comprobantes fiscales\n- Documentos para contabilidad\n- Reportes financieros"
          }
        },
        {
          "name": "Get Stripe Invoice",
          "request": {
            "method": "GET",
            "header": [
              {
                "key": "Authorization",
                "value": "Bearer {{jwt_token}}",
                "type": "text"
              }
            ],
            "url": {
              "raw": "{{base_url}}/admin/payments/{{payment_id}}/invoice",
              "host": ["{{base_url}}"],
              "path": ["admin", "payments", "{{payment_id}}", "invoice"]
            },
            "description": "Obtener detalles de una factura generada en Stripe"
          }
        },
        {
          "name": "Get Venues for Filtering",
          "request": {
            "method": "GET",
            "header": [
              {
                "key": "Authorization",
                "value": "Bearer {{jwt_token}}",
                "type": "text"
              }
            ],
            "url": {
              "raw": "{{base_url}}/admin/venues?simple=true",
              "host": ["{{base_url}}"],
              "path": ["admin", "venues"],
              "query": [
                {"key": "simple", "value": "true", "description": "Return simplified venue list for filters"}
              ]
            },
            "description": "Obtener lista simplificada de venues para filtros en dashboard administrativo"
          }
        }
      ],
      "description": "üÜï Panel administrativo completo para gesti√≥n de pagos, facturas y estad√≠sticas financieras"
    }
  ],
  "event": [
    {
      "listen": "prerequest",
      "script": {
        "type": "text/javascript",
        "exec": [
          "// Auto-configurar base URL seg√∫n el entorno",
          "const currentUrl = pm.request.url.host.join('.');",
          "if (currentUrl.includes('localhost')) {",
          "    pm.collectionVariables.set('base_url', 'http://localhost:3000/api');",
          "    console.log('üè† Ambiente: Desarrollo Local');",
          "} else {",
          "    pm.collectionVariables.set('base_url', 'https://reservapp-web.vercel.app/api');",
          "    console.log('üåê Ambiente: Producci√≥n (URL por defecto)');",
          "}",
          "",
          "// Auto-configurar variables de test si no existen",
          "if (!pm.collectionVariables.get('venue_id')) {",
          "    pm.collectionVariables.set('venue_id', 'venue_test_123');",
          "}",
          "if (!pm.collectionVariables.get('service_id')) {",
          "    pm.collectionVariables.set('service_id', 'service_test_456');",
          "}",
          "if (!pm.collectionVariables.get('reservation_id')) {",
          "    pm.collectionVariables.set('reservation_id', 'reservation_test_789');",
          "}",
          "",
          "// Log de estado de autenticaci√≥n",
          "const token = pm.collectionVariables.get('jwt_token');",
          "if (token) {",
          "    console.log('üîë Token JWT: Presente ‚úÖ');",
          "    // Extraer informaci√≥n del token (solo para logging, no para seguridad)",
          "    try {",
          "        const tokenPayload = JSON.parse(atob(token.split('.')[1]));",
          "        console.log('üë§ Usuario logueado:', tokenPayload.email || 'N/A');",
          "        console.log('üîê Rol:', tokenPayload.role || 'N/A');",
          "        const exp = new Date(tokenPayload.exp * 1000);",
          "        console.log('‚è∞ Token expira:', exp.toLocaleString());",
          "    } catch (e) {",
          "        console.log('‚ö†Ô∏è No se pudo decodificar token payload');",
          "    }",
          "} else {",
          "    console.log('üîë Token JWT: No presente ‚ùå');",
          "    console.log('üí° Ejecuta \"Login Usuario\" para autenticarte');",
          "}",
          "",
          "console.log('üåê Base URL actual:', pm.collectionVariables.get('base_url'));"
        ]
      }
    },
    {
      "listen": "test",
      "script": {
        "type": "text/javascript",
        "exec": [
          "// Tests globales aplicables a todas las respuestas",
          "",
          "// Test de tiempo de respuesta",
          "pm.test('‚ö° Response time is acceptable (<3s)', function () {",
          "    pm.expect(pm.response.responseTime).to.be.below(3000);",
          "});",
          "",
          "// Test de contenido JSON",
          "pm.test('üìã Response has JSON content-type', function () {",
          "    const contentType = pm.response.headers.get('Content-Type');",
          "    pm.expect(contentType).to.include('application/json');",
          "});",
          "",
          "// Tests espec√≠ficos para respuestas exitosas",
          "if (pm.response.code >= 200 && pm.response.code < 300) {",
          "    pm.test('‚úÖ Success response format is correct', function () {",
          "        const response = pm.response.json();",
          "        pm.expect(response).to.have.property('success', true);",
          "        pm.expect(response).to.have.property('message');",
          "        // timestamp es opcional pero si existe debe ser string",
          "        if (response.timestamp) {",
          "            pm.expect(response.timestamp).to.be.a('string');",
          "        }",
          "    });",
          "",
          "    // Auto-captura de IDs importantes para siguientes requests",
          "    const response = pm.response.json();",
          "    if (response.data) {",
          "        // Capturar IDs de recursos creados",
          "        if (response.data.id) {",
          "            const endpoint = pm.request.url.getPath().join('/');",
          "            if (endpoint.includes('venues') && pm.request.method === 'POST') {",
          "                pm.collectionVariables.set('venue_id', response.data.id);",
          "                console.log('üè® Venue ID capturado:', response.data.id);",
          "            } else if (endpoint.includes('services') && pm.request.method === 'POST') {",
          "                pm.collectionVariables.set('service_id', response.data.id);",
          "                console.log('üõéÔ∏è Service ID capturado:', response.data.id);",
          "            } else if (endpoint.includes('reservations') && pm.request.method === 'POST') {",
          "                pm.collectionVariables.set('reservation_id', response.data.id);",
          "                console.log('üìÖ Reservation ID capturado:', response.data.id);",
          "            }",
          "        }",
          "",
          "        // Capturar informaci√≥n de autenticaci√≥n",
          "        if (response.data.token) {",
          "            console.log('üîë Nuevo token JWT disponible');",
          "        }",
          "        if (response.data.user) {",
          "            console.log('üë§ Informaci√≥n de usuario disponible:', response.data.user.email);",
          "        }",
          "",
          "        // Log de datos importantes para debugging",
          "        if (response.data.paymentIntent) {",
          "            console.log('üí≥ Payment Intent creado:', response.data.paymentIntent.id);",
          "        }",
          "        if (response.data.subscription) {",
          "            console.log('üìã Suscripci√≥n creada:', response.data.subscription.id);",
          "        }",
          "    }",
          "}",
          "",
          "// Tests espec√≠ficos para respuestas de error",
          "if (pm.response.code >= 400) {",
          "    pm.test('‚ùå Error response format is correct', function () {",
          "        const response = pm.response.json();",
          "        pm.expect(response).to.have.property('success', false);",
          "        pm.expect(response).to.have.property('message');",
          "        // error es opcional pero si existe debe ser string",
          "        if (response.error) {",
          "            pm.expect(response.error).to.be.a('string');",
          "        }",
          "    });",
          "",
          "    // Log detallado de errores para debugging",
          "    const errorResponse = pm.response.json();",
          "    console.error('‚ùå Error details:', {",
          "        status: pm.response.code,",
          "        message: errorResponse.message,",
          "        error: errorResponse.error,",
          "        endpoint: pm.request.url.toString()",
          "    });",
          "}",
          "",
          "// Tests de status codes espec√≠ficos",
          "if (pm.response.code === 401) {",
          "    console.log('üîê Unauthorized - Verifica tu token JWT');",
          "} else if (pm.response.code === 403) {",
          "    console.log('üö´ Forbidden - Permisos insuficientes para este endpoint');",
          "} else if (pm.response.code === 429) {",
          "    console.log('‚è≥ Rate Limited - Demasiadas requests, espera un momento');",
          "}",
          "",
          "// Log del resultado general",
          "const statusEmoji = pm.response.code < 300 ? '‚úÖ' : pm.response.code < 500 ? '‚ö†Ô∏è' : '‚ùå';",
          "console.log(`${statusEmoji} Request completed: ${pm.response.code} ${pm.response.status} in ${pm.response.responseTime}ms`);"
        ]
      }
    }
  ]
}